---
/**
 * Navigation Component - Global site navigation
 * Features:
 * - Responsive design (mobile hamburger, desktop horizontal)
 * - CSS-only mobile menu toggle (no JavaScript)
 * - Active page highlighting
 * - Sticky header
 * - Accessibility (ARIA labels, keyboard navigation)
 * - Post-apocalyptic aesthetic
 */

// Get current pathname for active link highlighting
const currentPath = Astro.url.pathname;

// Navigation links (high-level funnel)
const navLinks = [
  { href: '/', label: 'Home' },
  { href: '/gameplay', label: 'Gameplay' },
  { href: '/early-access', label: 'Early Access' },
  { href: '/factions', label: 'Factions' },
  { href: '/biomes', label: 'Biomes' },
  { href: '/roadmap', label: 'Roadmap' },
  { href: '/media', label: 'Media' },
  { href: '/faq', label: 'FAQ' },
];

// Helper function to check if link is active
const isActive = (href: string) => {
  if (href === '/') {
    return currentPath === '/';
  }
  return currentPath.startsWith(href);
};
---

<nav
  class="fixed inset-x-0 top-0 z-50 border-b border-white/10 bg-black/80 backdrop-blur-lg transition-all duration-300"
  role="navigation"
  aria-label="Primary navigation"
>
  <div class="mx-auto flex h-16 max-w-6xl items-center justify-between px-4 sm:px-6 lg:h-20 lg:px-8">
    <a href="/" class="group flex flex-col leading-tight" aria-label="Bloom home">
      <span class="text-lg font-semibold uppercase tracking-[0.35em] text-white transition-colors group-hover:text-bloom-emerald sm:text-xl">
        Bloom
      </span>
      <span class="text-[0.55rem] font-mono uppercase tracking-[0.4em] text-white/60">
        Survive the Harvest
      </span>
    </a>

    <ul class="hidden items-center gap-4 text-[0.75rem] font-semibold uppercase tracking-[0.25em] text-white/70 lg:flex">
      {
        navLinks.map((link) => (
          <li>
            <a
              href={link.href}
              class={`relative inline-flex items-center gap-2 rounded-full px-3 py-2 transition-colors duration-200 ${
                isActive(link.href)
                  ? 'text-bloom-emerald'
                  : 'text-white/70 hover:text-white'
              }`}
              aria-current={isActive(link.href) ? 'page' : undefined}
              data-active={isActive(link.href)}
            >
              <span class="relative z-10">{link.label}</span>
              <span
                class={`absolute inset-0 rounded-full border border-white/10 transition-opacity ${
                  isActive(link.href) ? 'border-bloom-emerald/60 opacity-100' : 'opacity-0 group-hover:opacity-100'
                }`}
              />
            </a>
          </li>
        ))
      }
    </ul>

    <button
      id="nav-toggle"
      class="inline-flex h-11 w-11 items-center justify-center rounded-full border border-white/10 text-white transition hover:border-bloom-emerald hover:text-bloom-emerald focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-bloom-emerald lg:hidden"
      type="button"
      aria-label="Open navigation menu"
      aria-controls="mobile-nav"
      aria-expanded="false"
    >
      <svg id="nav-toggle-icon" class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8">
        <path stroke-linecap="round" d="M4 6h16M4 12h16M4 18h16" />
      </svg>
    </button>
  </div>

  <div id="mobile-nav" class="lg:hidden" data-open="false">
    <div
      class="fixed inset-0 top-16 bg-black/70 backdrop-blur-sm transition-opacity data-[open=false]:pointer-events-none data-[open=false]:opacity-0"
      data-mobile-overlay
      data-open="false"
      aria-hidden="true"
    ></div>
    <div
      class="fixed inset-x-0 top-16 origin-top rounded-b-3xl border-b border-white/10 bg-black/95 px-4 pb-8 pt-6 shadow-2xl transition duration-300 data-[open=false]:-translate-y-4 data-[open=false]:scale-y-95 data-[open=false]:opacity-0"
      data-mobile-panel
      data-open="false"
      aria-hidden="true"
    >
      <div class="mb-4 flex items-center justify-between px-1">
        <span class="text-xs font-semibold uppercase tracking-[0.35em] text-white/70">
          Navigate
        </span>
        <button
          id="nav-close"
          class="rounded-full bg-white/5 p-2 text-white transition hover:bg-white/10 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-bloom-emerald"
          type="button"
          aria-label="Close navigation menu"
        >
          <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8">
            <path stroke-linecap="round" d="M6 6l12 12M6 18L18 6" />
          </svg>
        </button>
      </div>
      <ul class="flex flex-col divide-y divide-white/5 rounded-2xl border border-white/5 bg-white/5">
        {
          navLinks.map((link) => (
            <li>
              <a
                href={link.href}
                class={`flex items-center justify-between px-4 py-4 text-sm font-semibold uppercase tracking-[0.2em] transition ${
                  isActive(link.href)
                    ? 'text-bloom-emerald'
                    : 'text-white/80 hover:bg-white/5 hover:text-white'
                }`}
                aria-current={isActive(link.href) ? 'page' : undefined}
                data-mobile-link
              >
                {link.label}
                <span class="text-[0.7rem] font-mono text-white/40">â†—</span>
              </a>
            </li>
          ))
        }
      </ul>
    </div>
  </div>
</nav>

<script is:inline>
  const navToggle = document.getElementById('nav-toggle')
  const navClose = document.getElementById('nav-close')
  const mobileNav = document.getElementById('mobile-nav')
  const mobilePanel = mobileNav?.querySelector('[data-mobile-panel]')
  const mobileOverlay = mobileNav?.querySelector('[data-mobile-overlay]')
  const mobileLinks = mobileNav?.querySelectorAll('[data-mobile-link]')

  const setMenuState = (isOpen) => {
    if (!mobileNav || !navToggle || !mobilePanel) return
    mobileNav.dataset.open = isOpen.toString()
    mobilePanel.dataset.open = isOpen.toString()
    mobileOverlay?.setAttribute('data-open', isOpen.toString())
    navToggle.setAttribute('aria-expanded', isOpen.toString())
    navToggle.setAttribute('aria-label', isOpen ? 'Close navigation menu' : 'Open navigation menu')
    document.documentElement.classList.toggle('overflow-hidden', isOpen)

    const icon = document.getElementById('nav-toggle-icon')
    if (icon) {
      icon.innerHTML = isOpen
        ? '<path stroke-linecap="round" d="M6 6l12 12M6 18L18 6" />'
        : '<path stroke-linecap="round" d="M4 6h16M4 12h16M4 18h16" />'
    }

    if (isOpen) {
      const firstLink = mobilePanel.querySelector('a')
      firstLink && setTimeout(() => firstLink.focus(), 200)
    } else {
      navToggle.focus()
    }
  }

  navToggle?.addEventListener('click', () => {
    const isOpen = mobileNav?.dataset.open === 'true'
    setMenuState(!isOpen)
  })

  navClose?.addEventListener('click', () => setMenuState(false))

  mobileLinks?.forEach((link) =>
    link.addEventListener('click', () => {
      setMenuState(false)
    })
  )

  document.addEventListener('keydown', (event) => {
    if (event.key === 'Escape' && mobileNav?.dataset.open === 'true') {
      setMenuState(false)
    }
  })
</script>
